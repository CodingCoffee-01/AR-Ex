<!DOCTYPE html>
<head>
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<title>Hello, world!</title>
	<!-- include three.js library -->
	<script src='js/three.js'></script>
</head>

<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>

<!--
  Example created by Lee Stemkoski: https://github.com/stemkoski
-->

<!-- ---------------- Custom Shader Code ------------------------ -->
<script id="vertexShader" type="x-shader/x-vertex">
uniform float time;
varying vec2 textureUV;
uniform sampler2D baseTexture;
void main()
{
    textureUV = uv;
	vec2 repeatUV = textureUV * vec2(4.0, 1.0);
	float sideDisplacement = 0.0;
	// side displacement only applied near edge of texture
	if (repeatUV.y < 0.15)
	{
		float angle = atan(position.y, position.x);
		float s1 = sin(8.3 * angle);
		float s2 = sin(7.1 * angle);
		sideDisplacement = 0.08 * s1 * s1 * abs(sin(0.65*time)) + 0.09 * s2 * s2 * abs(sin(0.74*time));
	}
	vec3 newPosition = position + normal * sideDisplacement;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );
}
</script>

<script id="fragmentShader" type="x-shader/x-vertex">
uniform float time;
uniform sampler2D baseTexture;
varying vec2 textureUV;
void main()
{
	vec2 repeatUV = textureUV * vec2(4.0, 1.0);
	// displacement creates scrolling effect on texture
	vec2 displaceUV = repeatUV + vec2(0.0, time/20.0);
	float alpha = 1.0;
	// transparency only applied near edge of texture
	if (repeatUV.y < 0.15)
		alpha = 1.0/0.15 * repeatUV.y;
	vec4 tintColor = texture2D( baseTexture, displaceUV ) * vec4( 1.0, 1.0, 1.0, alpha );
	gl_FragColor = tintColor;
}
</script>
<!-- ----------------------------------------------------------- -->

<script src="water-effect.js"></script>

</body>
</html>
